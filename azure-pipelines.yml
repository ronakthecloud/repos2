trigger:
- main
- dev

pr:
- '*'

pool:
  name: 'my-pool' # Replace with your agent pool name

variables:
  buildConfiguration: 'Release'
  sonarCloudToken: '1f6c45cb41277a1f2b61874b462324c4bb3bf6d6'  # Replace with the SonarCloud token you generated

stages:
- stage: BuildAndAnalyze
  displayName: 'Build and Analyze'
  jobs:
  - job: BuildAndAnalyze
    displayName: 'Build and Analyze Job'
    pool:
      name: 'my-pool' # Replace with your agent pool name

    steps:
    - checkout: self

    - script: |
        # Use the full path to the executable
        $HOME/sonar-scanner-4.6.2.2472-linux/bin/sonar-scanner \
          -Dsonar.organization=ronakthecloud \
          -Dsonar.projectKey=ronakthecloud_repos2 \
          -Dsonar.sources=. \
          -Dsonar.host.url=https://sonarcloud.io \
          -Dsonar.scanner.force-deprecated-java-version=true \
          -Dsonar.login=$(sonarCloudToken) \
          -X
      displayName: 'Run SonarCloud Analysis'

- stage: Deploy
  displayName: 'Deploy to Environment'
  dependsOn: BuildAndAnalyze
  condition: succeeded()

  jobs:
  - job: Deploy
    displayName: 'Deploy Job'
    pool:
      name: 'my-pool' # Replace with your agent pool name

    steps:
    - checkout: self

    - script: echo 'Deploying...'
      displayName: 'Deploy'
      # Add your deployment steps here, for example, copying files to a web server
